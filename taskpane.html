<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>SmartPricing Task Pane</title>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        #settingsModal {
            display: none;
            position: fixed;
            top:0; left:0;
            width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
        }
        #settingsModal div {
            background:white;
            padding:20px;
            border-radius:8px;
            width:300px;
        }
        button { margin-top: 10px; }
    </style>
</head>
<body>
    <h2>SmartPricing</h2>
    <button id="openSettings">Открыть Настройки</button>

    <!-- Модальное окно -->
    <div id="settingsModal">
      <div>
        <h3>Настройки</h3>
        <form id="settingsForm">
          <label>Название листа: <input type="text" name="sheetName" required></label><br><br>
          <label>Количество листов: <input type="number" name="sheetCount" min="1" value="1" required></label><br><br>
          <button type="submit">OK</button>
          <button type="button" id="closeModal">Отмена</button>
        </form>
      </div>
    </div>

<script>
Office.onReady((info) => {
    if (info.host === Office.HostType.Excel) {
        // Открытие модального
        document.getElementById("openSettings").onclick = () => {
            document.getElementById("settingsModal").style.display = "flex";
        };
        document.getElementById("closeModal").onclick = () => {
            document.getElementById("settingsModal").style.display = "none";
        };

        // Обработка формы
        document.getElementById("settingsForm").onsubmit = async (e) => {
            e.preventDefault();
            const form = e.target;
            const sheetName = form.sheetName.value;
            const sheetCount = parseInt(form.sheetCount.value);

            await Excel.run(async (context) => {
                const workbook = context.workbook;
                for (let i = 0; i < sheetCount; i++) {
                    workbook.worksheets.add(`${sheetName}_${i+1}`);
                }
                await context.sync();
            });

            // Закрываем модальное и сбрасываем форму
            document.getElementById("settingsModal").style.display = "none";
            form.reset();
        };
    }
});
</script>
</body>
</html>
