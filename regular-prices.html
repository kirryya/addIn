<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>SmartPricing Task Pane</title>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        #settingsModal {
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            justify-content: space-between;
            background: white;
            padding: 12px 20px 20px 20px;
            width: 782px;
            height: calc(100vh - 50px);
        }

        .title {
            font-weight: 500;
            font-size: 16px;
            line-height: 22px;
            vertical-align: middle;
            margin-right: auto;
        }

        #tabs {
            display: flex;
            margin-bottom: 16px;
            width: 100%;
            max-width: 230px;
        }

        .tab-button {
            flex: 1;
            cursor: pointer;
            border: none;
            font-size: 14px;
            min-width: 140px;
            padding: 0;
        }

        .tab-button.active {

            font-weight: 600;
            border-bottom: 2px solid #10793c;
            background: white;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: flex;
            flex-direction: column;
            row-gap: 12px;
            max-width: 782px;
        }

        #subTabs {
            display: flex;
            flex-wrap: wrap;
        }

        .sub-tab-button {
            padding: 6px 12px;
            cursor: pointer;
            border: none;
            min-width: fit-content;
            font-size: 12px;
            width: fit-content;
        }

        .sub-tab-button.active {
            font-weight: 600;
            border-bottom: 2px solid #10793c;
            background: white;
        }

        .sub-tab-pane {
            display: none;
        }

        .sub-tab-pane.active {
            display: flex;
            flex-direction: column;
            row-gap: 16px;
            width: 100%;
        }

        .sub-tab-container {
            display: flex;
            align-items: center;
            justify-content: space-between;

        }

        .subtitle {
            font-weight: 400;
            font-size: 14px;
            line-height: 22px;
            vertical-align: middle;
        }

        .sub-tab-container_subtitle {
            display: flex;
            flex-direction: column;
            max-width: 368px;
        }

        button {
            font-weight: 400;
            font-size: 18px;
            line-height: 24px;
            text-align: center;

            cursor: pointer;
            width: 122px;
            height: 39px;
            gap: 10px;
            opacity: 1;
            border-radius: 2px;
            padding: 6px 15px;
            border: 1px solid #D9D9D9;

            margin-top: 10px;

            background: #ffffff;

            &:hover {
                background: #D9D9D9;
            }

            &:active {
                background: #ffffff;
            }
        }

        #settingsForm {
            display: flex;
            flex-direction: column;
            row-gap: 12px;
            align-items: flex-start;
            width: 100%;
            height: calc(100vh - 135px);
        }

        .key_input {
            min-width: 359px;
            max-width: 924px;
            min-height: 30px;
            max-height: 30px;

            opacity: 1;
            border-radius: 12px;
            padding: 4px 12px;
            border: 1px solid #D9D9D9;
            outline: none;
        }

        .double {
            max-width: 342px; min-width: 342px
        }

        .key_select {
            width: 100%;
            min-width: 728px;
            min-height: 40px;
            max-height: 40px;

            opacity: 1;
            border-radius: 12px;
            padding: 4px 12px;
            border: 1px solid #D9D9D9;
            outline: none;
        }

        /* Стили для выпадающих пунктов */
        .key_select option {
            padding: 6px 10px;
            background-color: #fff;  /* фон списка */
            border: none;            /* браузеры часто игнорят */
        }

        /* Наведение на элемент */
        .key_select option:hover {
            background-color: #f5f5f5 !important;
        }

        /* Выбранный элемент */
        .key_select option:checked {
            background-color: #f5f5f5 !important;
            color: #000;
        }

        .custom-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
            font-family: sans-serif;
        }

        .custom-checkbox input {
            display: none;
        }

        .custom-checkbox span {
            width: 20px;
            height: 20px;
            border: 1px solid #D9D9D9;
            border-radius: 4px;
            display: inline-block;
            position: relative;
            background: white;
        }

        .custom-checkbox input:checked + span {
            background-color: #10793c;
            border-color: #10793c;
        }

        .custom-checkbox span::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 1px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
            opacity: 0;
        }

        .custom-checkbox input:checked + span::after {
            opacity: 1;
        }

        .checkbox-title {
            display: flex;
            flex-direction: column;
            row-gap: 12px;
            font-weight: 400;
            font-size: 14px;
            line-height: 22px;
            letter-spacing: 0;
        }

        .custom-radio {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
            font-family: sans-serif;
        }

        .custom-radio input {
            display: none;
        }

        .custom-radio span {
            width: 20px;
            height: 20px;
            border: 1px solid #D9D9D9;
            border-radius: 50%;
            display: inline-block;
            position: relative;
            background: white;
        }

        .custom-radio span::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10793c;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .custom-radio input:checked + span {
            border-color: #10793c;
        }

        .custom-radio input:checked + span::after {
            opacity: 1;
        }
    </style>
</head>
<body>

<div id="settingsModal">
        <span class="title">Регулярное розничное ценообразование</span>
    <div id="tabs">
        <button class="tab-button active" data-tab="general">Категории товаров</button>
        <button class="tab-button" data-tab="advanced">Параметры</button>
    </div>
    <form id="settingsForm">

    <div class="tab-pane active" id="general">
        <label class="subtitle">Группа товаров
            <select id="groupSelect" name="group" class="key_select">
                <option value="">-- выберите группу --</option>
                <option value="food">Продукты питания</option>
                <option value="drinks">Напитки</option>
                <option value="chemistry">Бытовая химия</option>
                <option value="electronics">Электроника</option>
            </select>
        </label>
        <label class="subtitle">Категория товаров
            <select id="categorySelect" name="category" class="key_select" disabled>
                <option value="">-- выберите категорию --</option>
            </select>
        </label>
    </div>



            <div class="tab-pane" id="advanced">
                <div id="subTabs">
                    <button class="sub-tab-button active" data-subtab="license">Правила</button>
                    <button class="sub-tab-button" data-subtab="codes">Ценовые сегменты</button>
                    <button class="sub-tab-button" data-subtab="kvi">Супер KVI</button>
                    <button class="sub-tab-button" data-subtab="groups">Конкурентное ЦО</button>
                    <button class="sub-tab-button" data-subtab="categories">Продвинутое ЦО</button>
                    <button class="sub-tab-button" data-subtab="subcategories">Параметры расчета</button>
                    <button class="sub-tab-button" data-subtab="extra">Системные</button>
                </div>

                <div id="subTabContent">
                    <!-- Подтаб 1 -->
                    <div class="sub-tab-pane active" id="license">
                        <label class="subtitle">Стратегия оптимизации цены
                            <select id="strategySelect" name="group" class="key_select">
                                <option value="food" selected>Максимизация валовой маржи</option>
                                <option value="drinks">Максимизация выручки</option>
                                <option value="chemistry">Сбалансированная</option>
                            </select>
                        </label>
                        <div class="checkbox-title">
                            <label class="custom-checkbox">
                                <input type="checkbox" name="useCodes">
                                <span></span>
                                Использовать вероятностный подход
                            </label>
                        </div>
                        <div class="checkbox-title">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="useCodes">
                                    <span></span>
                                    Компенсировать снижение целевых показателей
                                </label>
                            </div>
                        <div class="checkbox-title">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="useCodes">
                                    <span></span>
                                    Подбор оптимальных параметров расчета
                                </label>
                            </div>
                        <div class="checkbox-title">
                                <label class="custom-checkbox">
                                    <input type="checkbox" name="useCodes">
                                    <span></span>
                                    Проверять на предел снижения рентабельности
                                </label>
                            </div>
                        <label class="subtitle">Минимальная рентабельность SKU, %
                            <input type="text" name="sheetCount" class="key_input" style="width: 758px" autocomplete="off">
                        </label>
                        <div class="sub-tab-container">
                            <div class="sub-tab-container_subtitle">
                                <label for="sheetCount1" class="subtitle">Предел снижения всех товаров, кроме KVI, СТМ, КЦО и Новинок, %</label>
                                <input type="text" id="sheetCount1" name="sheetCount" class="key_input double" autocomplete="off">
                            </div>
                            <div class="sub-tab-container_subtitle">
                                <label for="sheetCount2" class="subtitle">Предел увеличения цены всех товаров, кроме KVI, СТМ и Новинок, %</label>
                                <input type="text" id="sheetCount2" name="sheetCount" class="key_input double" autocomplete="off">
                            </div>
                        </div>
                        <div class="sub-tab-container">
                            <div class="sub-tab-container_subtitle">
                                <label for="sheetCount3" class="subtitle">Ограничение изменения цены, %</label>
                                <input type="text" id="sheetCount3" name="sheetCount" class="key_input double" autocomplete="off">
                            </div>
                            <div class="sub-tab-container_subtitle">
                                <label for="sheetCount4" class="subtitle">Предел увеличения цены за период, %</label>
                                <input type="text" id="sheetCount4" name="sheetCount" class="key_input double" autocomplete="off">
                            </div>
                        </div>
                        <div class="sub-tab-container">
                            <div class="sub-tab-container_subtitle">
                                <div class="sub-tab-container_subtitle">
                                    <label for="sheetCount5" class="subtitle">Минимальная рентабельность для ЗЦ поставщиков, %</label>
                                    <input type="text" id="sheetCount5" name="sheetCount" class="key_input double" autocomplete="off">
                                </div>
                            </div>
                            <label class="subtitle" style="max-width: 368px;">Период
                                <select id="periodSelect" name="period" class="key_select" style="min-width: 368px" >
                                    <option value="food" selected>Неделя</option>
                                    <option value="drinks">Месяц</option>
                                    <option value="chemistry">Год</option>
                                </select>
                            </label>
                        </div>
                    </div>

                    <!-- Подтаб 2 -->
                    <div class="sub-tab-pane" id="codes">
                        <span class="subtitle">Ценовые сегменты</span>
                    </div>

                    <!-- Подтаб 3 -->
                    <div class="sub-tab-pane" id="kvi">
                        <span class="subtitle">Супер KVI</span>
                    </div>

                    <!-- Подтаб 4 -->
                    <div class="sub-tab-pane" id="groups">
                        <span class="subtitle">Конкурентное ЦО</span>
                    </div>

                    <!-- Подтаб 5 -->
                    <div class="sub-tab-pane" id="categories">
                        <span class="subtitle">Продвинутое ЦО</span>
                    </div>

                    <!-- Подтаб 6 -->
                    <div class="sub-tab-pane" id="subcategories">
                        <span class="subtitle">Параметры расчета</span>
                    </div>

                    <!-- Подтаб 7 -->
                    <div class="sub-tab-pane" id="extra">
                        <span class="subtitle">Системные</span>
                    </div>
                </div>


            </div>
        <div style="margin-left: auto; margin-top: auto;">
            <button type="submit">OK</button>
            <button type="button" id="close-button">Отмена</button>
        </div>
        </form>
</div>

<script>
    // Справочник групп и категорий
    const categoriesMap = {
        food: [
            { value: "dairy", text: "Молочные продукты" },
            { value: "bakery", text: "Хлебобулочные изделия" },
            { value: "meat", text: "Мясо и птица" },
            { value: "fruits", text: "Овощи и фрукты" }
        ],
        drinks: [
            { value: "water", text: "Вода" },
            { value: "juices", text: "Соки и нектары" },
            { value: "tea", text: "Чай и кофе" },
            { value: "alcohol", text: "Алкогольные напитки" }
        ],
        chemistry: [
            { value: "laundry", text: "Средства для стирки" },
            { value: "cleaning", text: "Чистящие средства" },
            { value: "dishes", text: "Средства для мытья посуды" },
            { value: "airfresh", text: "Освежители воздуха" }
        ],
        electronics: [
            { value: "phones", text: "Смартфоны" },
            { value: "laptops", text: "Ноутбуки" },
            { value: "tv", text: "Телевизоры" },
            { value: "appliances", text: "Мелкая бытовая техника" }
        ]
    };

    const groupSelect = document.getElementById("groupSelect");
    const categorySelect = document.getElementById("categorySelect");

    groupSelect.addEventListener("change", () => {
        const selectedGroup = groupSelect.value;
        categorySelect.innerHTML = '<option value="">-- выберите категорию --</option>';

        if (selectedGroup && categoriesMap[selectedGroup]) {
            categoriesMap[selectedGroup].forEach(cat => {
                const option = document.createElement("option");
                option.value = cat.value;
                option.textContent = cat.text;
                categorySelect.appendChild(option);
            });
            categorySelect.disabled = false;
        } else {
            categorySelect.disabled = true;
        }
    });

    document.querySelectorAll(".tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
            // убираем active со всех кнопок
            document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
            // активируем выбранную
            btn.classList.add("active");

            // скрываем все вкладки
            document.querySelectorAll(".tab-pane").forEach(pane => pane.classList.remove("active"));
            // показываем нужную
            document.getElementById(btn.dataset.tab).classList.add("active");
        });
    });

    document.querySelectorAll(".sub-tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
            // убрать active у кнопок
            document.querySelectorAll(".sub-tab-button").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            // спрятать все панели
            document.querySelectorAll(".sub-tab-pane").forEach(p => p.classList.remove("active"));
            document.getElementById(btn.dataset.subtab).classList.add("active");
        });
    });

    Office.onReady(() => {
        const form = document.getElementById("settingsForm");

        form.onsubmit = (e) => {
            e.preventDefault();
            if (Office.context.ui && Office.context.ui.messageParent) {
                Office.context.ui.messageParent("createSheets");
            }
        };
    });
</script>
</body>
</html>
